const Canvas = require('canvas')
const utils = require('../src/utils.js').default
const fs = require('fs')

describe('utils', () => {
  fit('can load image same as in browser', () => {
    const data = fs.readFileSync('./tests/images/forest/forest-cropped.jpg')
    const img = new Canvas.Image()
    img.src = data
    const canvas = Canvas.createCanvas(img.naturalWidth, img.naturalHeight)
    const ctx = canvas.getContext('2d')
    ctx.drawImage(img, 0, 0, img.naturalWidth, img.naturalHeight)
    // console.log(`<img src="${canvas.toDataURL()}" />`)
    const imageData = ctx.getImageData(50, 50, 1, 1)
    expect(imageData.data).toBe([])
  })

  it('can resize image same as in browser', async () => {
    const image = await loadImage('./tests/images/forest/forest-cropped.jpg')
    const canvas = utils.resizeImage(image, 32, 32)
    expect(canvas.toDataURL()).toBe(
      'data:image/png;base64,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'
    )
  })
})
