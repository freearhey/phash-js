!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).pHash=e()}(this,function(){"use strict";var w=function(t){var e,a;return"undefined"===document?(e=require("canvas").createCanvas,a=e(t.naturalWidth,t.naturalHeight)):((a=document.createElement("canvas")).width=t.naturalWidth,a.height=t.naturalHeight),a.getContext("2d").drawImage(t,0,0,t.naturalWidth,t.naturalHeight),a},C=function(t){for(var e=t.getContext("2d"),a=e.getImageData(0,0,t.width,t.height),n=a.data,r=0;r<n.length;r+=4){var o=.34*n[r]+.5*n[r+1]+.16*n[r+2];n[r]=o,n[r+1]=o,n[r+2]=o}return e.putImageData(a,0,0),t},x=function(t,e){var a;return"undefined"===document?a=(0,require("canvas").createCanvas)(e,e):((a=document.createElement("canvas")).width=e,a.height=e),a.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,e,e),a},y=function(t,e,a){a=t.getContext("2d").getImageData(e,a,1,1).data;return[a[0],a[1],a[2],a[3]/255]},D=function(t){for(var e=[],a=t.length,n=0;n<a;n++){for(var r=0,o=0;o<a;o++)r+=t[o]*Math.cos(n*Math.PI*(o+.5)/a);r*=Math.sqrt(2/a),0==n&&(r*=1/Math.sqrt(2)),e[n]=r}return e},M=function(t){var e=t.length-1;return t.slice(1,e).reduce(function(t,e){return t+e},0)/e},b=function(t){return parseInt(t,2).toString(16)};return function(t){var t=w(t),e=(C(t),x(t,32));(t=new Image).src=e.toDataURL(),document.body.appendChild(t),console.log('<img src="'+e.toDataURL()+'" width="500" height="500" />');for(var a=[],n=[],r=[],o=[],i=0;i<32;i++){for(var u=0;u<32;u++){var d=y(e,u,i);n[u]=parseInt(Math.floor(.299*d[0]+.587*d[1]+.114*d[2]))}r[i]=D(n)}for(var h=0;h<32;h++){for(var f=0;f<32;f++)o[f]=r[f][h];a[h]=D(o)}for(var c=[],g=0;g<8;g++)for(var s=0;s<8;s++)c.push(a[g][s]);for(var l=M(c),v=[],m=0,p=c;m<p.length;m++){var I=p[m];v.push(l<I?1:0)}return b(v.join(""))}});
